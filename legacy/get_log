#!/usr/bin/env bash

source run.properties

LINE_NUMBER="$1"

IFS=',' read -ra classes < "$OUTPUT_CLASSES_FILE"

CLASS_NUMBER=$(( ($LINE_NUMBER - 1) / $N_LOGS_PICK_FOR_RAE_FROM_EACH_CLASS ))
echo "$CLASS_NUMBER"

LINE_NUMBER_WITHIN_CLASS=$(( ($LINE_NUMBER - 1) % $N_LOGS_PICK_FOR_RAE_FROM_EACH_CLASS + 1))
echo "$LINE_NUMBER_WITHIN_CLASS"

NUMBER_IN_FULL_CONTEXT_FILE=$(( $CLASS_NUMBER * $MIN_WORD_OCCURENCIES + $LINE_NUMBER_WITHIN_CLASS ))
echo "$NUMBER_IN_FULL_CONTEXT_FILE"

ID=$( less $CONTEXT_INDEX_FILE | sed -n "${NUMBER_IN_FULL_CONTEXT_FILE}p" )
CLASS=${classes[$CLASS_NUMBER]}
CONTEXT=$( less $OUTPUT_CONTEXT_CORPUS_FILE | sed -n "${NUMBER_IN_FULL_CONTEXT_FILE}p" )

echo "$ID"
echo "$CLASS"
echo "$CONTEXT"
